var ae=Object.defineProperty,le=Object.defineProperties,ue=Object.getOwnPropertyDescriptors,Et=Object.getOwnPropertySymbols,ce=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable,Nt=t=>{throw TypeError(t)},kt=(t,e,n)=>e in t?ae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,b=(t,e)=>{for(var n in e||(e={}))ce.call(e,n)&&kt(t,n,e[n]);if(Et)for(var n of Et(e))he.call(e,n)&&kt(t,n,e[n]);return t},F=(t,e)=>le(t,ue(e)),Ft=(t,e,n)=>e.has(t)||Nt("Cannot "+n),l=(t,e,n)=>(Ft(t,e,"read from private field"),n?n.call(t):e.get(t)),_=(t,e,n)=>e.has(t)?Nt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),d=(t,e,n,s)=>(Ft(t,e,"write to private field"),e.set(t,n),n),U=(t,e,n)=>(Ft(t,e,"access private method"),n),f=(t,e,n)=>new Promise((s,r)=>{var i=u=>{try{a(n.next(u))}catch(c){r(c)}},o=u=>{try{a(n.throw(u))}catch(c){r(c)}},a=u=>u.done?s(u.value):Promise.resolve(u.value).then(i,o);a((n=n.apply(t,e)).next())});function ft(t){const e=t.filter(n=>!!n);return e.reduce((n,s)=>{const r="output"in n?n.output:n,i="input"in s?s.input:s;return r.connect(i),s}),()=>{e.reduce((n,s)=>{const r="output"in n?n.output:n,i="input"in s?s.input:s;return r.disconnect(i),s})}}function Tt(t){let e=t;const n=new Set;function s(o){return n.add(o),o(e),()=>{n.delete(o)}}function r(o){e=o,n.forEach(a=>a(e))}function i(){return e}return{subscribe:s,set:r,get:i}}function pe(){const t=new Set;function e(s){return t.add(s),()=>{t.delete(s)}}function n(s){t.forEach(r=>r(s))}return{subscribe:e,trigger:n}}function de(t){let e=!1;return()=>{e||(e=!0,t.forEach(n=>n?.()))}}function Mt(t){return t*t/16129}function fe(t){return Math.pow(10,t/20)}var T,E,H,$,_t,B,L,Bt=class{constructor(t,e){this.context=t,_(this,T),_(this,E),_(this,H),_(this,$),_(this,_t),_(this,B),_(this,L,!1);var n,s,r;d(this,B,{destination:(n=e?.destination)!=null?n:t.destination,volume:(s=e?.volume)!=null?s:100,volumeToGain:(r=e?.volumeToGain)!=null?r:Mt}),this.input=t.createGain(),d(this,T,t.createGain()),d(this,$,ft([this.input,l(this,T),l(this,B).destination]));const i=Tt(l(this,B).volume);this.setVolume=i.set,d(this,_t,i.subscribe(o=>{l(this,T).gain.value=l(this,B).volumeToGain(o)}))}addInsert(t){var e;if(l(this,L))throw Error("Can't add insert to disconnected channel");(e=l(this,H))!=null||d(this,H,[]),l(this,H).push(t),l(this,$).call(this),d(this,$,ft([this.input,...l(this,H),l(this,T),l(this,B).destination]))}addEffect(t,e,n){var s;if(l(this,L))throw Error("Can't add effect to disconnected channel");const r=this.context.createGain();r.gain.value=n;const i="input"in e?e.input:e,o=ft([l(this,T),r,i]);(s=l(this,E))!=null||d(this,E,[]),l(this,E).push({name:t,mix:r,disconnect:o})}sendEffect(t,e){var n;if(l(this,L))throw Error("Can't send effect to disconnected channel");const s=(n=l(this,E))==null?void 0:n.find(r=>r.name===t);s?s.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;l(this,L)||(d(this,L,!0),l(this,$).call(this),l(this,_t).call(this),(t=l(this,E))==null||t.forEach(e=>e.disconnect()),d(this,E,void 0))}};T=new WeakMap;E=new WeakMap;H=new WeakMap;$=new WeakMap;_t=new WeakMap;B=new WeakMap;L=new WeakMap;var M,_e=class{constructor(t){this.compare=t,_(this,M,[])}push(t){const e=l(this,M).length;let n=0,s=e-1,r=e;for(;n<=s;){const i=Math.floor((n+s)/2);this.compare(t,l(this,M)[i])<0?(r=i,s=i-1):n=i+1}l(this,M).splice(r,0,t)}pop(){return l(this,M).shift()}peek(){return l(this,M)[0]}removeAll(t){const e=l(this,M).length;return d(this,M,l(this,M).filter(n=>!t(n))),l(this,M).length!==e}clear(){d(this,M,[])}size(){return l(this,M).length}};M=new WeakMap;function Gt(t,e){return t&&e?n=>{t(n),e(n)}:t??e}function me(t){var e,n,s;const r={disableScheduler:(e=t.disableScheduler)!=null?e:!1,scheduleLookaheadMs:(n=t.scheduleLookaheadMs)!=null?n:200,scheduleIntervalMs:(s=t.scheduleIntervalMs)!=null?s:50,onStart:t.onStart,onEnded:t.onEnded};if(r.scheduleLookaheadMs<1)throw Error("scheduleLookaheadMs must be greater than 0");if(r.scheduleIntervalMs<1)throw Error("scheduleIntervalMs must be greater than 0");if(r.scheduleLookaheadMs<r.scheduleIntervalMs)throw Error("scheduleLookaheadMs must be greater than scheduleIntervalMs");return r}var A,D,O,Lt=class{constructor(t,e={}){_(this,A),_(this,D),_(this,O),d(this,A,me(e)),d(this,D,new _e((n,s)=>n.time-s.time)),this.player=t}get context(){return this.player.context}get buffers(){return this.player.buffers}get isRunning(){return l(this,O)!==void 0}start(t){var e;if(l(this,A).disableScheduler)return this.player.start(t);const n=this.player.context,s=n.currentTime,r=(e=t.time)!=null?e:s,i=l(this,A).scheduleLookaheadMs/1e3;return t.onStart=Gt(t.onStart,l(this,A).onStart),t.onEnded=Gt(t.onEnded,l(this,A).onEnded),r<s+i?this.player.start(t):(l(this,D).push(F(b({},t),{time:r})),l(this,O)||d(this,O,setInterval(()=>{const o=n.currentTime+i;for(;l(this,D).size()&&l(this,D).peek().time<=o;){const a=l(this,D).pop();a&&this.player.start(a)}l(this,D).size()||(clearInterval(l(this,O)),d(this,O,void 0))},l(this,A).scheduleIntervalMs)),o=>{!o||o<r?l(this,D).removeAll(a=>a===t)||this.player.stop(F(b({},t),{time:o})):this.player.stop(F(b({},t),{time:o}))})}stop(t){var e;if(l(this,A).disableScheduler)return this.player.stop(t);if(this.player.stop(t),!t){l(this,D).clear();return}const n=(e=t?.time)!=null?e:0,s=t?.stopId;s?l(this,D).removeAll(r=>r.time>=n&&r.stopId?r.stopId===s:r.note===s):l(this,D).removeAll(r=>r.time>=n)}disconnect(){this.player.disconnect()}};A=new WeakMap;D=new WeakMap;O=new WeakMap;var et,q,nt,Ot=class{constructor(t,e){this.context=t,this.options=e,_(this,et),_(this,q,!1),_(this,nt);var n,s;d(this,et,{velocityToGain:(n=e.velocityToGain)!=null?n:Mt,destination:(s=e.destination)!=null?s:t.destination}),this.buffers={},d(this,nt,pe())}start(t){var e,n,s,r,i,o,a,u,c,h,p,m,y,S;if(l(this,q))throw new Error("Can't start a sample on disconnected player");const g=this.context,R=t.name&&this.buffers[t.name]||this.buffers[t.note];if(!R)return console.warn(`Sample not found: '${t.note}'`),()=>{};const v=g.createBufferSource();v.buffer=R;const Y=(n=(e=t.detune)!=null?e:this.options.detune)!=null?n:0;v.detune?v.detune.value=Y:v.playbackRate&&(v.playbackRate.value=Math.pow(2,Y/1200));const W=(s=t.lpfCutoffHz)!=null?s:this.options.lpfCutoffHz,C=W?g.createBiquadFilter():void 0;W&&C&&(C.type="lowpass",C.frequency.value=W);const Q=g.createGain(),ot=(i=(r=t.velocity)!=null?r:this.options.velocity)!=null?i:100;Q.gain.value=l(this,et).velocityToGain(ot),((o=t.loop)!=null?o:this.options.loop)&&(v.loop=!0,v.loopStart=(a=t.loopStart)!=null?a:0,v.loopEnd=(u=t.loopEnd)!=null?u:R.duration);const at=(c=t.decayTime)!=null?c:this.options.decayTime,[lt,ut]=ye(g,at);function N(P){if(P??(P=g.currentTime),P<=tt)v.stop(P);else{const At=ut(P);v.stop(At)}}const V=t.gainOffset?g.createGain():void 0;V&&t.gainOffset&&(V.gain.value=t.gainOffset);const ct=(h=t.stopId)!=null?h:t.note,ht=de([ft([v,C,Q,lt,V,l(this,et).destination]),(p=t.stop)==null?void 0:p.call(t,N),l(this,nt).subscribe(P=>{(!P||P.stopId===void 0||P.stopId===ct)&&N(P?.time)})]);v.onended=()=>{var P;ht(),(P=t.onEnded)==null||P.call(t,t)},(m=t.onStart)==null||m.call(t,t);const tt=Math.max((y=t.time)!=null?y:0,g.currentTime);v.start(t.time);let pt=(S=t.duration)!=null?S:R.duration;return typeof t.duration=="number"&&N(tt+pt),N}stop(t){l(this,nt).trigger(t)}disconnect(){l(this,q)||(d(this,q,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!l(this,q)}};et=new WeakMap;q=new WeakMap;nt=new WeakMap;function ye(t,e=.2){let n=0;const s=t.createGain();s.gain.value=1;function r(i){if(n)return n;s.gain.cancelScheduledValues(i);const o=i||t.currentTime;return n=o+e,s.gain.setValueAtTime(1,o),s.gain.linearRampToValueAtTime(0,n),n}return[s,r]}var z=class{constructor(t,e){this.context=t;const n=new Bt(t,e);this.player=new Lt(new Ot(t,F(b({},e),{destination:n.input})),e),this.output=n}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop(typeof t=="object"?t:t!==void 0?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}};function J(t,e,n){return f(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");const s=yield n.fetch(e);if(s.status!==200){console.warn("Error loading buffer. Invalid status: ",s.status,e);return}try{const r=yield s.arrayBuffer();return yield t.decodeAudioData(r)}catch(r){console.warn("Error loading buffer",r,e)}})}function it(t){if(typeof document>"u")return null;const e=document.createElement("audio");for(let n=0;n<t.length;n++){const s=t[n],r=e.canPlayType(`audio/${s}`);if(r==="probably"||r==="maybe")return s;if(s==="m4a"){const i=e.canPlayType("audio/aac");if(i==="probably"||i==="maybe")return s}}return null}function jt(){var t;return"."+((t=it(["ogg","m4a"]))!=null?t:"ogg")}var G={fetch(t){return fetch(t)}},Z,mt,Ut,zt,dn=class{constructor(t="smplr"){_(this,mt),_(this,Z),typeof window>"u"||!("caches"in window)?d(this,Z,Promise.reject("CacheStorage not supported")):d(this,Z,caches.open(t))}fetch(t){return f(this,null,function*(){const e=new Request(t);try{return yield U(this,mt,Ut).call(this,e)}catch{const s=yield fetch(e);return yield U(this,mt,zt).call(this,e,s),s}})}};Z=new WeakMap;mt=new WeakSet;Ut=function(t){return f(this,null,function*(){const n=yield(yield l(this,Z)).match(t);if(n)return n;throw Error("Not found")})};zt=function(t,e){return f(this,null,function*(){try{yield(yield l(this,Z)).put(t,e.clone())}catch{}})};function Wt(t){return typeof t=="object"&&typeof t.baseUrl=="string"&&typeof t.name=="string"&&Array.isArray(t.samples)&&Array.isArray(t.groupNames)&&typeof t.nameToSampleName=="object"&&typeof t.sampleGroupVariations=="object"}var ve={baseUrl:"",name:"",samples:[],groupNames:[],nameToSampleName:{},sampleGroupVariations:{}};function Pe(t,e){return f(this,null,function*(){var n,s,r,i;const a=yield(yield e.fetch(t)).json();a.baseUrl=t.replace("/dm.json",""),a.groupNames=[],a.nameToSampleName={},a.sampleGroupVariations={};for(const u of a.samples){a.nameToSampleName[u]=u;const c=u.indexOf("/")!==-1?"/":"-",[h,p]=u.split(c);a.groupNames.includes(h)||a.groupNames.push(h),(s=(n=a.nameToSampleName)[h])!=null||(n[h]=u),(i=(r=a.sampleGroupVariations)[h])!=null||(r[h]=[]),p&&a.sampleGroupVariations[h].push(`${h}${c}${p}`)}return a})}function fn(){return Object.keys(Vt)}var Vt={"TR-808":"https://smpldsnds.github.io/drum-machines/TR-808/dm.json","Casio-RZ1":"https://smpldsnds.github.io/drum-machines/Casio-RZ1/dm.json","LM-2":"https://smpldsnds.github.io/drum-machines/LM-2/dm.json","MFB-512":"https://smpldsnds.github.io/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://smpldsnds.github.io/drum-machines/Roland-CR-8000/dm.json"};function ge(t){var e,n,s;const r={instrument:(e=t?.instrument)!=null?e:"TR-808",storage:(n=t?.storage)!=null?n:G,url:(s=t?.url)!=null?s:""};if(typeof r.instrument=="string"){if(r.url||(r.url=Vt[r.instrument]),!r.url)throw new Error("Invalid instrument: "+r.instrument)}else if(!Wt(r.instrument))throw new Error("Invalid instrument: "+r.instrument);return r}var I,_n=class{constructor(t,e){_(this,I,ve);const n=ge(e),s=Wt(n.instrument)?Promise.resolve(n.instrument):Pe(n.url,n.storage);this.player=new z(t,e),this.output=this.player.output,this.load=Me(t,this.player.buffers,s,n.storage).then(()=>this),s.then(r=>{d(this,I,r)})}getSampleNames(){return l(this,I).samples.slice()}getGroupNames(){return l(this,I).groupNames.slice()}getSampleNamesForGroup(t){var e;return(e=l(this,I).sampleGroupVariations[t])!=null?e:[]}start(t){var e;const n=l(this,I).nameToSampleName[t.note];return this.player.start(F(b({},t),{note:n||t.note,stopId:(e=t.stopId)!=null?e:t.note}))}stop(t){return this.player.stop(t)}loaded(){return f(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}get sampleNames(){return console.log("deprecated: Use getGroupNames instead"),l(this,I).groupNames.slice()}getVariations(t){var e;return console.warn("deprecated: use getSampleNamesForGroup"),(e=l(this,I).sampleGroupVariations[t])!=null?e:[]}};I=new WeakMap;function Me(t,e,n,s){var r;const i=(r=it(["ogg","m4a"]))!=null?r:"ogg";return n.then(o=>Promise.all(o.samples.map(a=>f(this,null,function*(){const u=`${o.baseUrl}/${a}.${i}`,c=yield J(t,u,s);c&&(e[a]=c)}))))}function be(t){const n=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!n)return;const s=n[1].toUpperCase();if(!s)return;const r=n[2],i=r[0]==="b"?-r.length:r.length,o=n[3]?+n[3]:4,a=(s.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][a]+i+12*(o+1)}function w(t){return t===void 0?void 0:typeof t=="number"?t:be(t)}function De(t,e,n,s){return f(this,null,function*(){n.groups.forEach(r=>{const i=Fe(n,r);return we(t,e,i,s)})})}function Se(t,e){return f(this,null,function*(){var n;const s=i=>"global"in i,r=i=>"websfzUrl"in i;if(typeof t=="string")return Rt(t);if(s(t))return t;if(r(t)){const i=yield Rt(t.websfzUrl);return(n=i.meta)!=null||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}else throw new Error("Invalid instrument: "+JSON.stringify(t))})}function we(t,e,n,s){return f(this,null,function*(){yield Promise.all(Object.keys(n).map(r=>f(this,null,function*(){if(e[r])return;const i=yield J(t,n[r],s);return i&&(e[r]=i),e})))})}function Rt(t,e){return f(this,null,function*(){try{return yield(yield fetch(t)).json()}catch(n){throw console.warn(`Can't load SFZ file ${t}`,n),new Error(`Can't load SFZ file ${t}`)}})}function Fe(t,e){var n,s,r,i;const o={},a=(n=t.meta.baseUrl)!=null?n:"",u=(r=it((s=t.meta.formats)!=null?s:[]))!=null?r:"ogg",c=(i=t.global.default_path)!=null?i:"";return e?e.regions.reduce((h,p)=>(p.sample&&(h[p.sample]=`${a}/${c}${p.sample}.${u}`),h),o):o}function x(t,e,n){const s=e===void 0||t!==void 0&&t>=e,r=n===void 0||t!==void 0&&t<=n;return s&&r}function Ae(t,e){const n=[];for(const s of t.groups)if(x(e.midi,s.lokey,s.hikey)&&x(e.velocity,s.lovel,s.hivel)&&x(e.cc64,s.locc64,s.hicc64))for(const r of s.regions)x(e.midi,r.lokey,r.hikey)&&x(e.velocity,r.lovel,r.hivel)&&x(e.cc64,s.locc64,s.hicc64)&&n.push([s,r]);return n}var Ie=Object.freeze({meta:{},global:{},groups:[]}),K,St,xt,Ee=class{constructor(t,e){this.context=t,_(this,St),_(this,K),this.options=Object.freeze(Object.assign({volume:100,velocity:100,storage:G,detune:0,destination:t.destination},e)),this.player=new z(t,e),d(this,K,Ie),this.load=Se(e.instrument,this.options.storage).then(n=>(d(this,K,Object.freeze(n)),De(t,this.player.buffers,l(this,K),this.options.storage))).then(()=>this)}get output(){return this.player.output}loaded(){return f(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}start(t){U(this,St,xt).call(this,typeof t=="object"?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};K=new WeakMap;St=new WeakSet;xt=function(t){var e;const n=w(t.note);if(n===void 0)return()=>{};const s=(e=t.velocity)!=null?e:this.options.velocity,r=Ae(l(this,K),{midi:n,velocity:s}),i=()=>{var a;(a=t.onEnded)==null||a.call(t,t)},o=r.map(([a,u])=>{var c,h,p;let m=(h=(c=u.pitch_keycenter)!=null?c:u.key)!=null?h:n;const y=(n-m)*100;return this.player.start(F(b({},t),{note:u.sample,decayTime:t.decayTime,detune:y+((p=t.detune)!=null?p:this.options.detune),onEnded:i,stopId:n}))});switch(o.length){case 0:return()=>{};case 1:return o[0];default:return a=>o.forEach(u=>u(a))}};function ke(t,e){const n=t.createGain(),s=t.createGain();n.channelCount=2,n.channelCountMode="explicit";const r=t.createChannelSplitter(2),i=t.createGain(),o=t.createGain(),a=t.createChannelMerger(2),u=t.createOscillator();u.type="sine",u.frequency.value=1,u.start();const c=t.createGain(),h=t.createOscillator();h.type="sine",h.frequency.value=1.1,h.start();const p=t.createGain();n.connect(r),r.connect(i,0),r.connect(o,1),i.connect(a,0,0),o.connect(a,0,1),u.connect(c),c.connect(i.gain),h.connect(p),p.connect(o.gain),a.connect(s);const m=e(y=>{c.gain.value=y,p.gain.value=y});return n.disconnect=()=>{m(),u.stop(),h.stop(),n.disconnect(r),r.disconnect(i,0),r.disconnect(o,1),i.disconnect(a,0,0),o.disconnect(a,0,1),u.disconnect(i),h.disconnect(o),a.disconnect(s)},{input:n,output:s}}function mn(){return Object.keys(Ht)}var Ht={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},yn=class extends Ee{constructor(t,e){var n;super(t,F(b({},e),{instrument:(n=Ht[e.instrument])!=null?n:e.instrument}));const s=Tt(0);this.tremolo={level:i=>s.set(Mt(i))};const r=ke(t,s.subscribe);this.output.addInsert(r)}};function Ge(t={}){return{groups:[],options:t}}function bt(){return{regions:[]}}function $t(t,e,n,s){const r=[],i=w(e.note);if(i===void 0)return r;for(const o of t.regions){const a=Xt(i,n??0,e,o,s);a&&r.push(a)}return r}function qt(t,e,n,s){const r=w(e.note);if(r!==void 0)for(const i of t.regions){const o=Xt(r,0,e,i,s);if(o)return o}}function Xt(t,e,n,s,r){var i,o,a,u,c,h,p,m,y,S,g,R,v,Y,W,C,Q,ot,Dt,at,lt,ut,N,V,ct,ht,tt,pt;if(!(t>=((i=s.midiLow)!=null?i:0)&&t<((o=s.midiHigh)!=null?o:127)+1)||!(n.velocity===void 0||n.velocity>=((a=s.velLow)!=null?a:0)&&n.velocity<=((u=s.velHigh)!=null?u:127)))return;if(s.seqLength){const ie=e%s.seqLength,oe=((c=s.seqPosition)!=null?c:1)-1;if(ie!==oe)return}const ee=t-s.midiPitch,It=(h=n.velocity)!=null?h:r?.velocity,ne=s.volume?fe(s.volume):0,se=(m=(p=n.gainOffset)!=null?p:r?.gainOffset)!=null?m:0,re=(y=n.detune)!=null?y:0;return{decayTime:(R=(g=n?.decayTime)!=null?g:(S=s.sample)==null?void 0:S.decayTime)!=null?R:r?.decayTime,detune:100*(ee+((v=s.tune)!=null?v:0))+re,duration:(C=(W=n?.duration)!=null?W:(Y=s.sample)==null?void 0:Y.duration)!=null?C:r?.duration,gainOffset:se+ne||void 0,loop:(Dt=(ot=n?.loop)!=null?ot:(Q=s.sample)==null?void 0:Q.loop)!=null?Dt:r?.loop,loopEnd:(ut=(lt=n?.loopEnd)!=null?lt:(at=s.sample)==null?void 0:at.loopEnd)!=null?ut:r?.loopEnd,loopStart:(ct=(V=n?.loopStart)!=null?V:(N=s.sample)==null?void 0:N.loopStart)!=null?ct:r?.loopStart,lpfCutoffHz:(pt=(tt=n?.lpfCutoffHz)!=null?tt:(ht=s.sample)==null?void 0:ht.lpfCutoffHz)!=null?pt:r?.lpfCutoffHz,name:s.sampleName,note:t,onEnded:n.onEnded,onStart:n.onStart,stopId:n.name,time:n.time,velocity:It??void 0}}function Kt(t){if(t.length===0)return[];if(t.sort((e,n)=>e.midiPitch-n.midiPitch),t[0].midiLow=0,t[0].midiHigh=127,t.length===1)return t;for(let e=1;e<t.length;e++){const n=t[e-1],s=t[e],r=Math.floor((n.midiPitch+s.midiPitch)/2);n.midiHigh=r,s.midiLow=r+1}return t[t.length-1].midiHigh=127,t}var Zt=class{constructor(t,e){this.context=t,this.seqNum=0;const n=new Bt(t,e);this.instrument=Ge(e),this.player=new Lt(new Ot(t,F(b({},e),{destination:n.input})),e),this.output=n}get buffers(){return this.player.buffers}start(t){const e=[],n=typeof t=="object"?t:{note:t};for(const s of this.instrument.groups){const r=$t(s,n,this.seqNum);this.seqNum++;for(const i of r){let o=this.player.start(i);e.push(o)}}return s=>e.forEach(r=>r(s))}stop(t){if(t==null){this.player.stop();return}const e=typeof t=="object"?t:{stopId:t},n=w(e.stopId);n&&(e.stopId=n,this.player.stop(e))}disconnect(){this.output.disconnect(),this.player.disconnect()}};function Jt(t,e){const n=jt();return(s,r)=>f(this,null,function*(){const i=yield fetch(t).then(u=>u.text()),o=Re(i,e.group);o.length&&console.warn("Problems converting sfz",o);const a=new Set;return e.group.regions.forEach(u=>a.add(u.sampleName)),Promise.all(Array.from(a).map(u=>f(this,null,function*(){const c=e.urlFromSampleName(u,n),h=yield J(s,c,r);e.buffers[u]=h}))).then(()=>e.group)})}function Re(t,e){let n="global";const s=t.split(`
`).map(Le).filter(o=>!!o),r=new Oe;let i=[];for(const o of s)switch(o.type){case"mode":i.push(r.closeScope(n,e)),n=o.value;break;case"prop:num":case"prop:str":case"prop:num_arr":r.push(o.key,o.value);break;case"unknown":console.warn("Unknown SFZ token",o.value);break}return i.filter(o=>!!o)}var Ce=/^<([^>]+)>$/,Ne=/^([^=]+)=([-\.\d]+)$/,Te=/^([^=]+)=(.+)$/,Be=/^([^=]+)_(\d+)=(\d+)$/;function Le(t){if(t=t.trim(),t===""||t.startsWith("//"))return;const e=t.match(Ce);if(e)return{type:"mode",value:e[1]};const n=t.match(Be);if(n)return{type:"prop:num_arr",key:n[1],value:[Number(n[2]),Number(n[3])]};const s=t.match(Ne);if(s)return{type:"prop:num",key:s[1],value:Number(s[2])};const r=t.match(Te);return r?{type:"prop:str",key:r[1],value:r[2]}:{type:"unknown",value:t}}var st,yt,Oe=class{constructor(){_(this,st),this.values={},this.global={},this.group={}}closeScope(t,e){if(t==="global")U(this,st,yt).call(this,this.global);else if(t==="group")this.group=U(this,st,yt).call(this,{});else if(t==="region"){const n=U(this,st,yt).call(this,b(b({sampleName:"",midiPitch:-1},this.global),this.group));if(n.sampleName==="")return"Missing sample name";if(n.midiPitch===-1)if(n.midiLow!==void 0)n.midiPitch=n.midiLow;else return"Missing pitch_keycenter";n.seqLength&&n.seqPosition===void 0&&(n.seqPosition=1),n.ampRelease&&(n.sample={decayTime:n.ampRelease},delete n.ampRelease),e.regions.push(n)}}get empty(){return Object.keys(this.values).length===0}get keys(){return Object.keys(this.values)}push(t,e){this.values[t]=e}popNum(t,e,n){return typeof this.values[t]!="number"?!1:(e[n]=this.values[t],delete this.values[t],!0)}popStr(t,e,n){return typeof this.values[t]!="string"?!1:(e[n]=this.values[t],delete this.values[t],!0)}popNumArr(t,e,n){return Array.isArray(this.values[t])?(e[n]=this.values[t],delete this.values[t],!0):!1}};st=new WeakSet;yt=function(t){return this.popStr("sample",t,"sampleName"),this.popNum("pitch_keycenter",t,"midiPitch"),this.popNum("ampeg_attack",t,"ampAttack"),this.popNum("ampeg_release",t,"ampRelease"),this.popNum("bend_down",t,"bendDown"),this.popNum("bend_up",t,"bendUp"),this.popNum("group",t,"group"),this.popNum("hikey",t,"midiHigh"),this.popNum("hivel",t,"velHigh"),this.popNum("lokey",t,"midiLow"),this.popNum("offset",t,"offset"),this.popNum("lovel",t,"velLow"),this.popNum("off_by",t,"groupOffBy"),this.popNum("pitch_keytrack",t,"ignore"),this.popNum("seq_length",t,"seqLength"),this.popNum("seq_position",t,"seqPosition"),this.popNum("tune",t,"tune"),this.popNum("volume",t,"volume"),this.popNumArr("amp_velcurve",t,"ampVelCurve"),this.values={},t};var dt=[],Yt="https://smpldsnds.github.io/sgossner-vcsl/";function vn(){return f(this,null,function*(){return dt.length||(dt=yield fetch(Yt+"sfz_files.json").then(t=>t.json())),dt})}function je(t){return Yt+t+".sfz"}function Ue(t,e){const n=je(t),r=`https://smpldsnds.github.io/sgossner-vcsl/${t.slice(0,t.lastIndexOf("/")+1)}`,i=bt();return Jt(n,{buffers:e,group:i,urlFromSampleName:(o,a)=>r+"/"+o.replace(".wav",a)})}var ze=class{constructor(t,e={}){var n,s;this.config={instrument:(n=e.instrument)!=null?n:"Arco",storage:(s=e.storage)!=null?s:G},this.player=new Zt(t,e);const r=Ue(this.config.instrument,this.player.buffers);this.load=r(t,this.config.storage).then(i=>(this.player.instrument.groups.push(i),this))}get output(){return this.player.output}get buffers(){return this.player.buffers}get context(){return this.player.context}start(t){return this.player.start(t)}stop(t){return this.player.stop(t)}disconnect(){this.player.disconnect()}};function Pn(){return Object.keys(Qt)}var gn=class extends ze{constructor(t,e){var n;super(t,F(b({},e),{instrument:Qt[(n=e.instrument)!=null?n:""]}))}},Qt={"Balafon - Hard Mallet":"Idiophones/Struck Idiophones/Balafon - Hard Mallet","Balafon - Keyswitch":"Idiophones/Struck Idiophones/Balafon - Keyswitch","Balafon - Soft Mallet":"Idiophones/Struck Idiophones/Balafon - Soft Mallet","Balafon - Traditional Mallet":"Idiophones/Struck Idiophones/Balafon - Traditional Mallet","Tubular Bells 1":"Idiophones/Struck Idiophones/Tubular Bells 1","Tubular Bells 2":"Idiophones/Struck Idiophones/Tubular Bells 2","Vibraphone - Bowed":"Idiophones/Struck Idiophones/Vibraphone - Bowed","Vibraphone - Hard Mallets":"Idiophones/Struck Idiophones/Vibraphone - Hard Mallets","Vibraphone - Keyswitch":"Idiophones/Struck Idiophones/Vibraphone - Keyswitch","Vibraphone - Soft Mallets":"Idiophones/Struck Idiophones/Vibraphone - Soft Mallets","Xylophone - Hard Mallets":"Idiophones/Struck Idiophones/Xylophone - Hard Mallets","Xylophone - Keyswitch":"Idiophones/Struck Idiophones/Xylophone - Keyswitch","Xylophone - Medium Mallets":"Idiophones/Struck Idiophones/Xylophone - Medium Mallets","Xylophone - Soft Mallets":"Idiophones/Struck Idiophones/Xylophone - Soft Mallets"},We={"300 STRINGS CELLO":["300 STRINGS","CELL"],"300 STRINGS VIOLA":["300 STRINGS","VIOL"]};function Mn(){return["300 STRINGS CELLO","300 STRINGS VIOLA","8VOICE CHOIR","BASSA+STRNGS","BOYS CHOIR","CHA CHA FLT","CHM CLARINET","CHMB 3 VLNS","CHMB ALTOSAX","CHMB FEMALE","CHMB MALE VC","CHMB TNR SAX","CHMB TRMBONE","CHMB TRUMPET","CHMBLN CELLO","CHMBLN FLUTE","CHMBLN OBOE","DIXIE+TRMBN","FOXTROT+SAX","HALFSP.BRASS","MIXED STRGS","MKII BRASS","MKII GUITAR","MKII ORGAN","MKII SAX","MKII VIBES","MKII VIOLINS","MOVE BS+STGS","STRGS+BRASS","TROMB+TRMPT","TRON 16VLNS","TRON CELLO","TRON FLUTE","TRON VIOLA"]}var bn=class{constructor(t,e){this.context=t,this.options=e,this.config=Ve(e),this.player=new z(t,e),this.group=bt();const n=xe(this.config.instrument,this.player.buffers,this.group);this.load=n(t,this.config.storage).then(()=>this)}get buffers(){return this.player.buffers}get output(){return this.player.output}start(t){const e=qt(this.group,typeof t=="object"?t:{note:t},void 0,this.options);return e?this.player.start(e):()=>{}}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function Ve(t){var e,n;return{instrument:(e=t.instrument)!=null?e:"MKII VIOLINS",storage:(n=t.storage)!=null?n:G}}function xe(t,e,n){let s=We[t];return s&&(t=s[0]),(r,i)=>{const o=`https://smpldsnds.github.io/archiveorg-mellotron/${t}/`,a=jt();return fetch(o+"files.json").then(u=>u.json()).then(u=>Promise.all(u.map(c=>{var h;if(s&&!c.includes(s[1]))return;const p=w((h=c.split(" ")[0])!=null?h:"");if(!p)return;const m=o+c+a;J(r,m,i).then(y=>{var S;e[c]=y;const g=(S=y?.duration)!=null?S:0;n.regions.push({sampleName:c,midiPitch:p,sample:{loop:!0,loopStart:g/10,loopEnd:g-g/10}})})}))).then(()=>{Kt(n.regions)})}}var He='"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();',$e=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],Ct=new WeakMap;function qe(t){return f(this,null,function*(){let e=Ct.get(t);if(!e){const s=new Blob([He],{type:"application/javascript"}),r=URL.createObjectURL(s);e=t.audioWorklet.addModule(r),Ct.set(t,e)}return yield e,new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]})})}var k,vt,X,Dn=class{constructor(t){_(this,k),_(this,vt),_(this,X),this.input=t.createGain(),d(this,X,t.destination),d(this,vt,qe(t).then(e=>(this.input.connect(e),e.connect(l(this,X)),d(this,k,e),this)))}get paramNames(){return $e}getParam(t){var e;return(e=l(this,k))==null?void 0:e.parameters.get("preDelay")}get isReady(){return l(this,k)!==void 0}ready(){return l(this,vt)}connect(t){l(this,k)&&(l(this,k).disconnect(l(this,X)),l(this,k).connect(t)),d(this,X,t)}};k=new WeakMap;vt=new WeakMap;X=new WeakMap;var j,Sn=class{constructor(t,e={}){this.context=t,_(this,j);var n,s,r,i,o,a;d(this,j,{destination:(n=e.destination)!=null?n:t.destination,detune:0,volume:(s=e.volume)!=null?s:100,velocity:(r=e.velocity)!=null?r:100,buffers:(i=e.buffers)!=null?i:{},volumeToGain:(o=e.volumeToGain)!=null?o:Mt}),this.player=new z(t,l(this,j));const u=(a=e.storage)!=null?a:G,c=typeof l(this,j).buffers=="function"?l(this,j).buffers:Xe(l(this,j).buffers,u);this.load=c(t,this.player.buffers).then(()=>this)}loaded(){return f(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}get output(){return this.player.output}start(t){return this.player.start(typeof t=="object"?t:{note:t})}stop(t){return this.player.stop(typeof t=="object"?t:t===void 0?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};j=new WeakMap;function Xe(t,e){return(n,s)=>f(this,null,function*(){yield Promise.all([Object.keys(t).map(r=>f(this,null,function*(){const i=t[r];if(i instanceof AudioBuffer)s[r]=i;else if(typeof i=="string"){const o=yield J(n,i,e);o&&(s[r]=o)}}))])})}function wn(){return["Pizzicato","Arco","Switched"]}function Ke(t){return`https://smpldsnds.github.io/sfzinstruments-dsmolken-double-bass/d_smolken_rubner_bass_${{Arco:"arco",Pizzicato:"pizz",Switched:"switched"}[t]}.sfz`}var Fn=class{constructor(t,e={}){this.seqNum=0;var n,s;this.config={instrument:(n=e.instrument)!=null?n:"Arco",storage:(s=e.storage)!=null?s:G},this.player=new z(t,e),this.group=bt();const r=Ke(this.config.instrument),i=Jt(r,{buffers:this.player.buffers,group:this.group,urlFromSampleName:(o,a)=>`https://smpldsnds.github.io/sfzinstruments-dsmolken-double-bass/${o.replace("\\","/").replace(".wav",a)}`});this.load=i(t,this.config.storage).then(()=>this)}get output(){return this.player.output}get buffers(){return this.player.buffers}get context(){return this.player.context}start(t){const e=$t(this.group,typeof t=="object"?t:{note:t},this.seqNum);this.seqNum++;const n=e.map(s=>this.player.start(s));return s=>n.forEach(r=>r(s))}stop(t){if(t==null){this.player.stop();return}const e=typeof t=="object"?t:{stopId:t},n=w(e.stopId);n&&(e.stopId=n,this.player.stop(e))}disconnect(){this.player.disconnect()}};function Ze(t,e){var n;const s=(n=it(["ogg","mp3"]))!=null?n:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${s}.js`}function Je(t,e,n){return(s,r)=>f(this,null,function*(){const i=yield(yield r.fetch(t)).text(),o=Ye(i),a=Object.keys(o);yield Promise.all(a.map(u=>f(this,null,function*(){const c=w(u);if(!c)return;const h=tn(Qe(o[u])),p=yield s.decodeAudioData(h);e[u]=p,n.regions.push({sampleName:u,midiPitch:c})}))),Kt(n.regions)})}function Ye(t){const e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");const n=t.indexOf("=",e)+2,s=t.lastIndexOf(",");return JSON.parse(t.slice(n,s)+"}")}function Qe(t){return t.slice(t.indexOf(",")+1)}function tn(t){const e=window.atob(t),n=e.length,s=new Uint8Array(n);for(let r=0;r<n;r++)s[r]=e.charCodeAt(r);return s.buffer}var en=["MusyngKite","FluidR3_GM"],nn=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function sn(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}function rn(t,e=44100){return f(this,null,function*(){if(t)try{const n=yield fetch(t);if(n.status!==200)return;const s=yield n.json(),r={};return Object.keys(s).forEach(i=>{const o=w(i);if(o){const a=s[i];r[o]=[a[0]/e,a[1]/e]}}),r}catch{return}})}function An(){return en}function In(){return nn}var rt,En=class{constructor(t,e){this.context=t,_(this,rt),this.config=an(e),this.player=new z(t,e),this.group=bt(),d(this,rt,!1);const n=on(this.config.instrumentUrl,this.config.loopDataUrl,this.player.buffers,this.group);this.load=n(t,this.config.storage).then(r=>(d(this,rt,r),this));const s=t.createGain();s.gain.value=this.config.extraGain,this.player.output.addInsert(s)}get output(){return this.player.output}get hasLoops(){return l(this,rt)}loaded(){return f(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}disconnect(){this.player.disconnect()}start(t){const e=qt(this.group,typeof t=="object"?t:{note:t});return e?this.player.start(e):()=>{}}stop(t){return this.player.stop(t)}};rt=new WeakMap;function on(t,e,n,s){const r=Je(t,n,s);return(i,o)=>f(this,null,function*(){const[a,u]=yield Promise.all([r(i,o),rn(e)]);return u&&s.regions.forEach(c=>{var h;const p=u[c.midiPitch];p&&((h=c.sample)!=null||(c.sample={}),c.sample.loop=!0,c.sample.loopStart=p[0],c.sample.loopEnd=p[1])}),!!u})}function an(t){var e,n,s,r;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");const i={kit:"MusyngKite",instrument:t.instrument,storage:(e=t.storage)!=null?e:G,extraGain:(n=t.extraGain)!=null?n:5,loadLoopData:(s=t.loadLoopData)!=null?s:!1,loopDataUrl:t.loopDataUrl,instrumentUrl:(r=t.instrumentUrl)!=null?r:""};if(i.instrument&&i.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),i.instrumentUrl=i.instrument,i.instrument=void 0),i.instrumentUrl)(i.kit||i.instrument)&&console.warn("Soundfont: 'kit' and 'instrument' config parameters are ignored because 'instrumentUrl' is explicitly set.");else if(i.instrument)i.instrumentUrl=Ze(i.instrument,i.kit);else throw Error("Soundfont: 'instrument' or 'instrumentUrl' configuration parameter is required");return i.loadLoopData&&i.instrument&&!i.loopDataUrl&&(i.loopDataUrl=sn(i.instrument,i.kit)),i}var Pt,kn=class{constructor(t,e){this.context=t,this.options=e,_(this,Pt,[]),this.player=new Zt(t,e),this.load=un(e).then(n=>{this.soundfont=n,d(this,Pt,n.instruments.map(s=>s.header.name))}).then(()=>this)}get instrumentNames(){return l(this,Pt)}loadInstrument(t){var e,n,s;const r=(e=this.soundfont)==null?void 0:e.instruments.find(u=>u.header.name===t);if(!r)return;const i=this.player.buffers,o={regions:[]};for(const u of r.zones){const c=u.sample,h=c.header,p=ln(this.context,c);let m={sampleName:c.header.name,midiPitch:c.header.originalPitch,midiLow:(n=u.keyRange)==null?void 0:n.lo,midiHigh:(s=u.keyRange)==null?void 0:s.hi,sample:{loop:h.startLoop>=0&&h.endLoop>h.startLoop,loopStart:h.startLoop/h.sampleRate,loopEnd:h.endLoop/h.sampleRate}};o.regions.push(m),i[m.sampleName]=p}const a={groups:[o],options:this.options};return this.player.instrument=a,[a,i]}get output(){return this.player.output}start(t){return this.player.start(t)}stop(t){return this.player.stop(t)}disconnect(){this.player.disconnect()}};Pt=new WeakMap;function ln(t,e){const{header:n,data:s}=e,r=new Float32Array(s.length);for(let a=0;a<s.length;a++)r[a]=s[a]/32768;const i=t.createBuffer(1,r.length,n.sampleRate);return i.getChannelData(0).set(r),i}function un(t){return f(this,null,function*(){const e=yield fetch(t.url).then(s=>s.arrayBuffer()),n=new Uint8Array(e);return t.createSoundfont(n)})}var cn="https://danigb.github.io/samples/splendid-grand-piano",wt,te,Gn=class{constructor(t,e){this.context=t,_(this,wt),this.options=Object.assign({baseUrl:cn,storage:G,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new z(t,this.options);const n=pn(this.options.baseUrl,this.options.storage,this.options.notesToLoad);this.load=n(t,this.player.buffers).then(()=>this)}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return f(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}start(t){var e,n;const s=typeof t=="object"?b({},t):{note:t},r=U(this,wt,te).call(this,s);return r?(s.note=r[0],s.stopId=(e=s.stopId)!=null?e:r[1],s.detune=r[2]+((n=s.detune)!=null?n:this.options.detune),this.player.start(s)):()=>{}}stop(t){var e;if(typeof t=="string")return this.player.stop((e=w(t))!=null?e:t);if(typeof t=="object"){const n=w(t.stopId);return this.player.stop(n!==void 0?F(b({},t),{stopId:n}):t)}else return this.player.stop(t)}};wt=new WeakSet;te=function(t){var e;const n=w(t.note);if(!n)return;const s=(e=t.velocity)!=null?e:this.options.velocity,r=gt.findIndex(o=>s>=o.vel_range[0]&&s<=o.vel_range[1]),i=gt[r];if(i)return hn(i.name,n,this.player.buffers)};function hn(t,e,n){let s=0;for(;n[t+(e+s)]===void 0&&s<128;)s>0?s=-s:s=-s+1;return s===127?[t+e,e,0]:[t+(e+s),e,-s*100]}function pn(t,e,n){var s;const r=(s=it(["ogg","m4a"]))!=null?s:"ogg";let i=n?gt.filter(o=>o.vel_range[0]<=n.velocityRange[1]&&o.vel_range[1]>=n.velocityRange[0]):gt;return(o,a)=>f(this,null,function*(){for(const u of i){const c=n?u.samples.filter(h=>n.notes.includes(h[0])):u.samples;yield Promise.all(c.map(h=>f(this,[h],function*([p,m]){const y=`${t}/${m}.${r}`,S=yield J(o,y,e);S&&(a[u.name+p]=S)})))}})}var gt=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}];export{dn as CacheStorage,_n as DrumMachine,yn as ElectricPiano,G as HttpStorage,gt as LAYERS,gn as Mallet,bn as Mellotron,Qt as NAME_TO_PATH,Dn as Reverb,Sn as Sampler,Fn as Smolken,En as Soundfont,kn as Soundfont2Sampler,Gn as SplendidGrandPiano,Ue as VcslInstrumentLoader,ze as Versilian,fn as getDrumMachineNames,mn as getElectricPianoNames,Pn as getMalletNames,Mn as getMellotronNames,wn as getSmolkenNames,An as getSoundfontKits,In as getSoundfontNames,vn as getVersilianInstruments};
